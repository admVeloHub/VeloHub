
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Nova estrutura para nÃ¡lise de viabilidade e confiabilidade                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
quero que vc leia atentamente a proposta estrutural abaixo e entregue uma analise de viabiliade e confiabilidade da proposta, incluindo um relatorio de fluxo completo e possÃ­veis pontos de quebra do processo.
USUÃRIO ACESSA A ABA VELOBOT  Ponto 0
          â”‚
          â–¼ IMEDIATO
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€---------------------â”€â”€â”
â”‚  VALIDAÃ‡ÃƒO de SESSÃƒO                 |
|  cache do collection Bot_perguntas   |
|  HANDSHAKE IA +determinar prioridade â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€----------------------â”€â”€â”˜
          â”‚
          â–¼ Ponto1
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USUÃRIO FAZ PERGUNTA
|  envia de log de pergunta (ja deveria estar funcional)(envio google sheets)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          |
          |Ponto2
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
| Filtro â†’ Prompt OTIMIZADO
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼Ponto3
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CHAMADA DE IA  â”‚
â”‚  PRIMÃRIA       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          | SE FALHA -->|CHAMADA DE IA SECUNDARIA| SE FALHA -->|BUSCA TRADICIONAL|
          â–¼Ponto4
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ANÃLISE IA     â”‚
â”‚  analyzeQuestionâ”‚
â”‚  WithAI()       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼ Ponto5
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RESULTADO      â”‚
â”‚  - 1 opÃ§Ã£o:     â”‚
â”‚    Resposta     â”‚
â”‚  - MÃºltiplas:   â”‚
â”‚    Esclarec.------>USUÃRIO ESCOLHE ITEM DESEJADO NO CLARIFICATION> RESULTADO DIRETO SEM CHAMADA DE IA   
â”‚  - Nenhuma:     â”‚
â”‚    Erro         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              PROPOSTA ATUAL                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            PONTOS DE QUEBRA                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”´ CRÃTICOS:
â€¢ MongoDB indisponÃ­vel â†’ Sistema para
â€¢ Ambas IAs falham â†’ Busca tradicional (pode falhar)
â€¢ Filtro muito restritivo â†’ Nenhum resultado

ğŸŸ¡ MÃ‰DIOS:
â€¢ Cache de status desatualizado â†’ IA errada
â€¢ Keywords mal configuradas â†’ Filtro ineficaz
â€¢ Clarification sem dados â†’ Erro

ğŸŸ¢ BAIXOS:
â€¢ Handshake lento â†’ Delay inicial
â€¢ Filtro muito amplo â†’ Performance reduzida

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              RECOMENDAÃ‡Ã•ES                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“ CHECKLIST DE TAREFAS (ORDEM DE EXECUÃ‡ÃƒO) - ATUALIZADO:

1. CORREÃ‡ÃƒO SCHEMA MONGODB âœ…
[x] Corrigir campos do schema MongoDB (Pergunta, Resposta, Palavras-chave, Sinonimos)

2. LOG PARALELO GOOGLE SHEETS âœ…
[x] Implementar log paralelo para Google Sheets (nÃ£o bloqueia resposta)

3. VALIDAÃ‡ÃƒO E SESSÃƒO INICIAL âœ…
[x] Mover validaÃ§Ã£o e sessÃ£o para acesso inicial do VeloBot (nÃ£o na pergunta)
[x] Integrar handshake das IAs no acesso inicial (VALIDAÃ‡ÃƒO + SESSÃƒO + HANDSHAKE IA)
[x] Simplificar sistema de sessÃ£o (apenas memÃ³ria de conversa - 10 minutos)

4. HANDSHAKE DAS IAs âœ… (INICIALIZAÃ‡ÃƒO + REFRESH PERIÃ“DICO)
[x] Criar endpoint /api/chatbot/health-check
[x] Testar disponibilidade OpenAI e Gemini
[x] Determinar IA primÃ¡ria (OpenAI preferencial)
[x] Cache de status (TTL 5min)
[x] Log de handshake
[x] Implementar 3 cenÃ¡rios corretos do handshake:
    [x] CenÃ¡rio 1: OpenAI OK â†’ OpenAI primÃ¡ria + Gemini secundÃ¡ria
    [x] CenÃ¡rio 2: OpenAI NULL + Gemini OK â†’ Gemini primÃ¡ria + OpenAI secundÃ¡ria
    [x] CenÃ¡rio 3: OpenAI NULL + Gemini NULL â†’ MantÃ©m primeira opÃ§Ã£o

5. FILTRO MONGODB âœ…
[x] Implementar filtro por keywords/sinÃ´nimos
[x] Query otimizada com fallback amplo
[x] Reduzir de 297 para 30 perguntas relevantes (otimizado)
[x] Log de filtros aplicados

6. INVERSÃƒO ORDEM IAs âœ… (LÃ“GICA DINÃ‚MICA)
[x] OpenAI como primÃ¡ria na anÃ¡lise
[x] Gemini como fallback
[x] Manter redundÃ¢ncia completa
[x] Testar cenÃ¡rios de falha
[x] Aplicar lÃ³gica consistente em todos os endpoints

7. CLARIFICATION DIRETO âœ…
[x] Armazenar dados da anÃ¡lise inicial
[x] Resposta direta sem re-anÃ¡lise
[x] Manter compatibilidade com sistema atual
[x] Log de clarification direto

8. CACHE DE STATUS âœ…
[x] Implementar cache Redis/Memory
[x] TTL de 5 minutos
[x] InvalidaÃ§Ã£o automÃ¡tica
[x] Fallback para teste direto

9. FUNÃ‡Ã•ES AUXILIARES âœ…
[x] Implementar getBotPerguntasData() para carregar dados do MongoDB
[x] Implementar getArticlesData() para carregar dados do MongoDB
[x] Integrar carregamento de cache na inicializaÃ§Ã£o

10. TESTES E VALIDAÃ‡ÃƒO â³
[ ] Testar cenÃ¡rios de falha das IAs
[ ] Validar performance do filtro MongoDB
[ ] Verificar logs de handshake
[ ] Teste de carga com mÃºltiplos usuÃ¡rios
[ ] Validar fallback para busca tradicional
[ ] Testar clarification direto
[ ] Verificar consistÃªncia dos 3 cenÃ¡rios do handshake

11. OTIMIZAÃ‡Ã•ES FUTURAS â³
[ ] Implementar cache Redis para sessÃµes (se necessÃ¡rio)
[ ] Otimizar queries MongoDB com Ã­ndices
[ ] Implementar mÃ©tricas de performance
[ ] Adicionar monitoramento de saÃºde das IAs
[ ] Implementar rate limiting se necessÃ¡rio

--------------------------------------
diagrama visual do Status do app
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
|Status do APP  â”‚ ğŸŸ¢ CrÃ©dito      â”‚ ğŸŸ¢ CrÃ©dito     â”‚ ğŸŸ¡ AntecipaÃ§Ã£o  â”‚
|              â”‚    Trabalhador   â”‚    Pessoal      â”‚                  â”‚
|               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
|               â”‚ ğŸ”´ Pagamento    â”‚ ğŸŸ¢ MÃ³dulo IRPF | (pronto para )  â”‚
|               â”‚    Antecipado   â”‚                 |  item adicional)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜